{
  "name": "Project Status Interviewer - voice",
  "nodes": [
    {
      "parameters": {
        "operation": "get",
        "documentURL": "={{ $json.document_id }}"
      },
      "type": "n8n-nodes-base.googleDocsTool",
      "typeVersion": 2,
      "position": [
        -112,
        2208
      ],
      "id": "af6f69af-5f33-4126-bff8-1c26e2704d4f",
      "name": "Get a document in Google Docs",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "k1EoHiegV47vo2db",
          "name": "Google Docs account - Andreas"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1136,
        1312
      ],
      "id": "5715bb30-b744-44c1-9a42-fd172fd0e275",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.slack_channel_id }}",
          "mode": "id"
        },
        "text": "placeholder",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -240,
        1536
      ],
      "id": "6b08988f-fc32-47a1-add2-534dd16f78ee",
      "name": "request for status message",
      "webhookId": "6ff647e5-740b-4039-8924-7e0cd1134d3d",
      "credentials": {
        "slackApi": {
          "id": "EJLrJ9PwnDzNVVZS",
          "name": "project-status-interviewer"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -240,
        2208
      ],
      "id": "488ffe46-7f1c-4a83-b27a-f0f322dd1df1",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "v9FJw7ANGGH6VI9i",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        112,
        2080
      ],
      "id": "756b4e9e-ce59-43b5-ad49-b7e97f5adaca",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9737e0fc-e917-4ad7-8cc3-eb3209a6ba0c",
              "name": "=current_kw",
              "value": "={{ $now.toFormat('WW') }}",
              "type": "string"
            },
            {
              "id": "897f1531-f6a6-4a7e-b30b-8c7a09536072",
              "name": "year",
              "value": "={{ $now.toFormat('yyyy') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        2416
      ],
      "id": "f81dfd02-4ba9-4cfa-92d7-7ce68667c0ba",
      "name": "get_date_for_agent1"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "fetch-last-report",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1136,
        2080
      ],
      "id": "db509c62-b852-4f82-ae6b-4a4bea071027",
      "name": "Fetch last report",
      "webhookId": "66e575b9-2104-49aa-9065-2fa1d3474d17"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Fetch last report').item.json.body.last_report_request }}",
        "options": {
          "systemMessage": "=You are an operations assistant supporting a Voice AI agent. Your goal is to provide a concise status update that is easy to read aloud.\n\nTASK:\n1. Use the 'Get a document in Google Docs' tool to retrieve the content of the document (ID: {{ $json.document_id }}).\n2. Extract the core status of project {{ $('Select earliest entry').item.json.project_name }}.\n\nOUTPUT REQUIREMENTS:\n- Length: Exactly 3-5 sentences.\n- Tone: Professional but conversational (suitable for text-to-speech). Avoid jargon or complex formatting like bullet points within the text string.\n- Content: Focus on what was achieved and what is currently pending.\n\nOUTPUT FORMAT:\n- Return ONLY a clean JSON object.\n- Format: {\"previous_summary\": \"The summary text goes here.\"}\n\nCRITICAL:\n- No markdown formatting (no **bold**, no ```json blocks).\n- Do not mention the Document ID or technical metadata in the summary.\n- If the document is inaccessible, return: {\"previous_summary\": \"I couldn't access the latest project report, so I don't have a specific update on that right now.\"}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -240,
        1984
      ],
      "id": "1407f119-619d-4db0-86e7-19e2890c26f3",
      "name": "Report fetcher"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "submit-status-report",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1136,
        2416
      ],
      "id": "88b92490-2596-486d-80ea-33c4d0c2746e",
      "name": "Submit status report",
      "webhookId": "66e575b9-2104-49aa-9065-2fa1d3474d17"
    },
    {
      "parameters": {
        "folderId": "={{ $('Select earliest entry1').item.json.drive_folder_id }}",
        "title": "=Statusbericht_{{ $('Select earliest entry1').item.json.project_name }}_{{ $('get_date_for_agent1').item.json.year }}_KW{{ $('get_date_for_agent1').item.json.current_kw }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        -16,
        2416
      ],
      "id": "5c0b3e50-3bbf-456a-9dc4-d1183a06abac",
      "name": "Create a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "k1EoHiegV47vo2db",
          "name": "Google Docs account - Andreas"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1104,
        2416
      ],
      "id": "1f37c593-566b-483c-8fe3-080cb11ec2cf",
      "name": "Respond to Webhook4"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $json.id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "={{ $('Create a document').item.json.name }}\n\n## Current things\n\n{{ $('Submit status report').item.json.body.activities }}\n\n## Next steps\n\n{{ $('Submit status report').item.json.body.next_steps }}\n\n## Support needed\n\n{{ $('Submit status report').item.json.body.support_needed }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        208,
        2416
      ],
      "id": "1bdc27b2-a163-42b3-8c2c-4e8d0a7dff67",
      "name": "Update a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "k1EoHiegV47vo2db",
          "name": "Google Docs account - Andreas"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                1
              ],
              "triggerAtHour": 15
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -1136,
        1536
      ],
      "id": "ec6f8dba-2666-457f-b60c-e93f4f67221c",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "verify_slot_is_empty",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1136,
        1760
      ],
      "id": "841173e1-54f5-495e-9453-18c5deaceca5",
      "name": "verify_slot_is_empty",
      "webhookId": "66e575b9-2104-49aa-9065-2fa1d3474d17"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9737e0fc-e917-4ad7-8cc3-eb3209a6ba0c",
              "name": "=kw",
              "value": "={{ $now.toFormat('WW') }}",
              "type": "string"
            },
            {
              "id": "897f1531-f6a6-4a7e-b30b-8c7a09536072",
              "name": "year",
              "value": "={{ $now.toFormat('yyyy') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -912,
        1760
      ],
      "id": "7b9e0b7b-43d2-4da2-915d-09c21442200b",
      "name": "get_current_date1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -240,
        1760
      ],
      "id": "d444b00d-ced4-49a2-aca3-f60d644c22f1",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "swj7LKIJWI42CJSM",
          "mode": "list",
          "cachedResultName": "project_status_overview",
          "cachedResultUrl": "/projects/dAHyp2o5R1jdG6yX/datatables/swj7LKIJWI42CJSM"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "kw",
              "keyValue": "={{ $('get_current_date1').item.json.kw }}"
            },
            {
              "keyName": "year",
              "keyValue": "={{ $('get_current_date1').item.json.year }}"
            },
            {
              "keyName": "project_id",
              "keyValue": "={{ $('verify_slot_is_empty').item.json.body.project_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -688,
        1760
      ],
      "id": "6a4a14f4-f424-4aa8-a508-1ac6c6142ab7",
      "name": "get_this_kw_row",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// Check if the previous node (get_this_kw_row) returned any items\nconst inputItems = $input.all();\n\n// If the array is empty, it means the row wasn't found (slot is free)\nconst isSlotEmpty = inputItems.length === 0 || Object.keys(inputItems[0].json).length === 0;\n\nreturn {\n  slot_empty: isSlotEmpty\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -464,
        1760
      ],
      "id": "5195a45d-3158-4aff-ab52-9aef25c1e1fa",
      "name": "return_boolean"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "createdAt",
              "order": "descending"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        -688,
        2080
      ],
      "id": "f508f7b2-0bf2-422c-9124-76011d205f32",
      "name": "Sort createdAt desc"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "swj7LKIJWI42CJSM",
          "mode": "list",
          "cachedResultName": "project_status_overview",
          "cachedResultUrl": "/projects/dAHyp2o5R1jdG6yX/datatables/swj7LKIJWI42CJSM"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "project_id",
              "keyValue": "={{ $('Fetch last report').item.json.body.project_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -912,
        2080
      ],
      "id": "1b3fcf27-2f3a-44ab-89ad-21e8166c2266",
      "name": "get_rows"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -464,
        2080
      ],
      "id": "7b1df163-8437-464c-9f78-a16d42e2265e",
      "name": "Select earliest entry"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "swj7LKIJWI42CJSM",
          "mode": "list",
          "cachedResultName": "project_status_overview",
          "cachedResultUrl": "/projects/dAHyp2o5R1jdG6yX/datatables/swj7LKIJWI42CJSM"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "year": "={{ $('get_date_for_agent1').item.json.year }}",
            "kw": "={{ $('get_date_for_agent1').item.json.current_kw }}",
            "project_name": "={{ $('Select earliest entry1').item.json.project_name }}",
            "project_owner": "={{ $('Select earliest entry1').item.json.project_owner }}",
            "document_id": "={{ $('Create a document').item.json.id }}",
            "project_id": "={{ $('Select earliest entry1').item.json.project_id }}",
            "drive_folder_id": "={{ $('Select earliest entry1').item.json.drive_folder_id }}",
            "slack_ts": "={{ $('Submit status report').item.json.body.slack_ts }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "kw",
              "displayName": "kw",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "year",
              "displayName": "year",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "project_owner",
              "displayName": "project_owner",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "project_id",
              "displayName": "project_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "project_name",
              "displayName": "project_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "document_id",
              "displayName": "document_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "drive_folder_id",
              "displayName": "drive_folder_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "slack_ts",
              "displayName": "slack_ts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        432,
        2416
      ],
      "id": "d6638d39-1d8c-4f75-ad2c-83dee3a695ad",
      "name": "Insert row"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C0A3NUD8DD5",
          "mode": "id"
        },
        "text": "=Statusbericht angelegt. Zum Nachbearbeiten (z. B. mit weiteren POs): https://docs.google.com/document/d/{{ $('Create a document').item.json.id }}/edit",
        "otherOptions": {
          "thread_ts": {
            "replyValues": {
              "thread_ts": "={{ $('Submit status report').item.json.body.slack_ts }}"
            }
          }
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        656,
        2416
      ],
      "id": "3ec5cb64-cc0e-43a7-802b-7745a83e1b81",
      "name": "Post Google Doc link in thread",
      "webhookId": "dedf6605-4d79-432a-841f-b5746e2da69e",
      "credentials": {
        "slackApi": {
          "id": "EJLrJ9PwnDzNVVZS",
          "name": "project-status-interviewer"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "CHXaFl7Pv82RthV4",
          "mode": "list",
          "cachedResultName": "project_status_project_owners",
          "cachedResultUrl": "/projects/dAHyp2o5R1jdG6yX/datatables/CHXaFl7Pv82RthV4"
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -912,
        1536
      ],
      "id": "83e589d2-9236-4c3f-aab6-7854595d1a0a",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst grouped = {};\n\n\n\nfor (const item of items) {\n  const project = item.json.project_name;\n  const id = item.json.project_id;\n  const owner = item.json.project_owner;\n  const slackId = item.json.project_owner_slack_id;\n\n  // Format the owner (e.g., \"Andreas\" or \"@Andreas\" if you use Slack IDs)\n  const ownerDisplay = slackId ? `<@${slackId}>` : owner;\n  if (!grouped[project]) {\n\n    grouped[project] = {\n\n      project_name: project,\n      project_id: id,\n      owners: [ownerDisplay]\n\n    };\n\n  } else {\n\n    grouped[project].owners.push(ownerDisplay);\n\n  }\n\n}\n\n\n\n// Convert the object back into an array n8n can loop through\n\nreturn Object.values(grouped).map(group => ({\n\n  json: {\n\n    project_name: group.project_name,\n    project_id: group.project_id,\n    combined_owners: group.owners.join(\", \") // Creates \"Ellen, Ben\"\n\n  }\n\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -688,
        1536
      ],
      "id": "3cbe6cd4-c4ce-4263-963a-a207085ca068",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f48e7c84-ecf9-4797-8d0c-f8b41f4a7fad",
              "name": "slack_channel_id",
              "value": "C0A3NUD8DD5",
              "type": "string"
            },
            {
              "id": "323b1349-ba82-451f-a687-e2d6e0c51c01",
              "name": "current_kw",
              "value": "={{ $now.toFormat('WW') }}",
              "type": "string"
            },
            {
              "id": "ef5d1b84-0308-4276-b23e-ee53153fb3da",
              "name": "year",
              "value": "={{ $now.toFormat('yyyy') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -464,
        1536
      ],
      "id": "e7d44dda-2c64-439b-9279-08345d491a25",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "createdAt",
              "order": "descending"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        -688,
        2416
      ],
      "id": "39474fee-5817-4a13-9e9f-5a1da9f0465c",
      "name": "Sort createdAt desc1"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "CHXaFl7Pv82RthV4",
          "mode": "list",
          "cachedResultName": "project_status_project_owners",
          "cachedResultUrl": "/projects/dAHyp2o5R1jdG6yX/datatables/CHXaFl7Pv82RthV4"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "project_id",
              "keyValue": "={{ $('Submit status report').item.json.body.project_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -912,
        2416
      ],
      "id": "a16093f1-0977-42c5-a486-ffcc2d116bc1",
      "name": "get_rows1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -464,
        2416
      ],
      "id": "44bd9f32-e17b-4810-8195-d47354d0ad2c",
      "name": "Select earliest entry1"
    },
    {
      "parameters": {
        "operation": "update",
        "channelId": {
          "__rl": true,
          "value": "C0A3NUD8DD5",
          "mode": "id"
        },
        "ts": "={{ $json.message.ts }}",
        "messageType": "block",
        "blocksUi": "={\n  \"blocks\": [\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"ðŸ‘‹ Bitte gib ein Status-Update fÃ¼r *{{ $('Code in JavaScript').item.json.project_name }}* fÃ¼r KW-{{ $('Edit Fields').item.json.current_kw }}-{{ $('Edit Fields').item.json.year }}. {{ $('Code in JavaScript').item.json.combined_owners }}\"\n      }\n    },\n    {\n      \"type\": \"actions\",\n      \"elements\": [\n        {\n          \"type\": \"button\",\n          \"text\": {\n            \"type\": \"plain_text\",\n            \"text\": \"ðŸ“ Status abgeben\",\n            \"emoji\": true\n          },\n          \"style\": \"primary\",\n          \"url\": \"https://elevenlabs.io/app/talk-to?agent_id=agent_1501kgkzbqnzfyys53p1820hq3a9&branch_id=agtbrch_3301kgkzbseafrx8erkqvbbg2wn7&var_project_id={{ $('Code in JavaScript').item.json.project_id }}&var_slack_ts={{ $json.message.ts }}\",\n          \"action_id\": \"status_button\"        }\n      ]\n    }\n  ]\n}",
        "text": "=",
        "updateFields": {},
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        -16,
        1536
      ],
      "id": "bd856749-7f90-425b-9245-b6348ae542f6",
      "name": "Update a message",
      "webhookId": "3b210b11-af32-462e-b9f5-04ed2de555ca",
      "credentials": {
        "slackApi": {
          "id": "EJLrJ9PwnDzNVVZS",
          "name": "project-status-interviewer"
        }
      }
    },
    {
      "parameters": {
        "resource": "reaction",
        "channelId": {
          "__rl": true,
          "value": "C0A3NUD8DD5",
          "mode": "id"
        },
        "timestamp": "={{ $('Submit status report').item.json.body.slack_ts }}",
        "name": "white_check_mark"
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        880,
        2416
      ],
      "id": "4a1b8a80-bce4-4cea-81c7-d9b732ca48a4",
      "name": "Update Slack message",
      "webhookId": "dedf6605-4d79-432a-841f-b5746e2da69e",
      "credentials": {
        "slackApi": {
          "id": "EJLrJ9PwnDzNVVZS",
          "name": "project-status-interviewer"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                2
              ],
              "triggerAtHour": 10
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -1136,
        1120
      ],
      "id": "8427337c-e46c-466d-94c9-501c2a36f32d",
      "name": "Reminder trigger"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "NNlMwdCabs22Qj0T",
          "mode": "list",
          "cachedResultName": "project_status_slack",
          "cachedResultUrl": "/projects/dAHyp2o5R1jdG6yX/datatables/NNlMwdCabs22Qj0T"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "kw",
              "keyValue": "={{ $json.kw }}"
            },
            {
              "keyName": "year",
              "keyValue": "={{ $json.year }}"
            }
          ]
        },
        "limit": 20
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        -688,
        1264
      ],
      "id": "09c9744b-bf06-4ecd-a999-dbdcf2238483",
      "name": "Get project list"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -464,
        1264
      ],
      "id": "8753e6b8-296f-41e3-80ca-367c6d7cdb55",
      "name": "Loop Over Items",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "reaction",
        "operation": "get",
        "channelId": {
          "__rl": true,
          "value": "C0A3NUD8DD5",
          "mode": "id"
        },
        "timestamp": "={{ $json.slack_ts }}"
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        -16,
        992
      ],
      "id": "34772992-fa55-4dbd-adde-99007bd87db0",
      "name": "Get reaction",
      "webhookId": "675d90c6-e83c-4fb8-9990-54484f275b19",
      "credentials": {
        "slackApi": {
          "id": "EJLrJ9PwnDzNVVZS",
          "name": "project-status-interviewer"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  const msg = item.json.message;\n  let hasCheckMark = false;\n\n  // 1. Check if the 'reactions' array even exists and has items\n  // This 'Short-Circuits' the logic for 90% of messages\n  if (msg && msg.reactions && msg.reactions.length > 0) {\n    // 2. Only now do we do the 'expensive' search\n    hasCheckMark = msg.reactions.some(r => r.name === 'white_check_mark');\n  }\n\n  return {\n    json: {\n      ...item.json,\n      has_check_mark: hasCheckMark\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        1072
      ],
      "id": "f92a26f6-24c5-4ed7-a85c-132d08daee08",
      "name": "Check for checkmark"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "6cd0d1d5-d9bf-4cfd-a227-338634759b62",
              "leftValue": "={{ $json.has_check_mark }}",
              "rightValue": "white_check_mark",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        432,
        1072
      ],
      "id": "40ac0abe-7c51-4c30-982a-245537780001",
      "name": "If message has checkmark"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C0A3NUD8DD5",
          "mode": "id"
        },
        "text": "={{ $('Loop Over Items').item.json.combined_owners }} report reminder. ",
        "otherOptions": {
          "thread_ts": {
            "replyValues": {
              "thread_ts": "={{ $('Loop Over Items').item.json.slack_ts }}"
            }
          }
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        656,
        1136
      ],
      "id": "0f0120f8-1049-42e8-b6f1-730894b455d8",
      "name": "Send reminder",
      "webhookId": "049344f6-954b-4d94-99cd-a9fbb3fca1f9",
      "credentials": {
        "slackApi": {
          "id": "EJLrJ9PwnDzNVVZS",
          "name": "project-status-interviewer"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "4087cb58-57f6-4ffb-84be-e6052eb5ee0b",
              "leftValue": "={{ $json.slack_ts }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -240,
        1072
      ],
      "id": "631a0ea2-a553-45b2-86f4-03cfd5a999b2",
      "name": "If"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "NNlMwdCabs22Qj0T",
          "mode": "list",
          "cachedResultName": "project_status_slack",
          "cachedResultUrl": "/projects/dAHyp2o5R1jdG6yX/datatables/NNlMwdCabs22Qj0T"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "kw": "={{ $('Edit Fields').item.json.current_kw }}",
            "year": "={{ $('Edit Fields').item.json.year }}",
            "slack_ts": "={{ $('request for status message').item.json.message_timestamp }}",
            "project_id": "={{ $('Code in JavaScript').item.json.project_name }}",
            "combined_owners": "={{ $('Code in JavaScript').item.json.combined_owners }}",
            "project_name": "={{ $('Code in JavaScript').item.json.project_name }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "slack_ts",
              "displayName": "slack_ts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "project_id",
              "displayName": "project_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "kw",
              "displayName": "kw",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "year",
              "displayName": "year",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "combined_owners",
              "displayName": "combined_owners",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "project_name",
              "displayName": "project_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1.1,
      "position": [
        208,
        1536
      ],
      "id": "76a3c4a1-abc2-428c-9ed3-0f620bf6ab52",
      "name": "Insert row1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9737e0fc-e917-4ad7-8cc3-eb3209a6ba0c",
              "name": "=kw",
              "value": "={{ $now.toFormat('WW') }}",
              "type": "string"
            },
            {
              "id": "897f1531-f6a6-4a7e-b30b-8c7a09536072",
              "name": "year",
              "value": "={{ $now.toFormat('yyyy') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -912,
        1264
      ],
      "id": "678a6bc4-c4db-4a36-9e1f-4ed35f8eb339",
      "name": "get_current_date"
    }
  ],
  "pinData": {},
  "connections": {
    "Get a document in Google Docs": {
      "ai_tool": [
        [
          {
            "node": "Report fetcher",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Report fetcher",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "get_date_for_agent1": {
      "main": [
        [
          {
            "node": "Create a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch last report": {
      "main": [
        [
          {
            "node": "get_rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Report fetcher": {
      "main": [
        [
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Submit status report": {
      "main": [
        [
          {
            "node": "get_rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a document": {
      "main": [
        [
          {
            "node": "Update a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a document": {
      "main": [
        [
          {
            "node": "Insert row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verify_slot_is_empty": {
      "main": [
        [
          {
            "node": "get_current_date1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_current_date1": {
      "main": [
        [
          {
            "node": "get_this_kw_row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_this_kw_row": {
      "main": [
        [
          {
            "node": "return_boolean",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "return_boolean": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort createdAt desc": {
      "main": [
        [
          {
            "node": "Select earliest entry",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_rows": {
      "main": [
        [
          {
            "node": "Sort createdAt desc",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select earliest entry": {
      "main": [
        [
          {
            "node": "Report fetcher",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert row": {
      "main": [
        [
          {
            "node": "Post Google Doc link in thread",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Post Google Doc link in thread": {
      "main": [
        [
          {
            "node": "Update Slack message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "request for status message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort createdAt desc1": {
      "main": [
        [
          {
            "node": "Select earliest entry1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_rows1": {
      "main": [
        [
          {
            "node": "Sort createdAt desc1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select earliest entry1": {
      "main": [
        [
          {
            "node": "get_date_for_agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "request for status message": {
      "main": [
        [
          {
            "node": "Update a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Slack message": {
      "main": [
        [
          {
            "node": "Respond to Webhook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reminder trigger": {
      "main": [
        [
          {
            "node": "get_current_date",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get project list": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get reaction": {
      "main": [
        [
          {
            "node": "Check for checkmark",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check for checkmark": {
      "main": [
        [
          {
            "node": "If message has checkmark",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If message has checkmark": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send reminder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send reminder": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Get reaction",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check for checkmark",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a message": {
      "main": [
        [
          {
            "node": "Insert row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_current_date": {
      "main": [
        [
          {
            "node": "Get project list",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": true
  },
  "versionId": "b1942086-9db8-4ec2-9662-8a964813f634",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "58bc80b014303e07f209f1f5092cd304e8b2f3edba5fbc1cb7f21a27b4c47b4d"
  },
  "id": "KnHWPuO3qJoIwzOogJxUn",
  "tags": []
}